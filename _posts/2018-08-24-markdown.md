---
layout: post
title: æ­å»ºä¸è¿è¡Œä»¥å¤ªåŠç§é“¾
date: 2018-08-24
categories: skill
tags: Ethereum blockchian json
---

# æ­å»ºä¸è¿è¡Œä»¥å¤ªåŠç§é“¾

1. ####å»ºç«‹ç§é“¾ç›®å½• 

   ```
   $ mkdir gethtest
   $ cd gethtest
   ```

2. ####é…ç½®åˆ›ä¸–æ–‡ä»¶genesis.json

   ```
   $ touch genesis.json
   $ vi genesis.json
   ```

   æ‹·è´ä»¥ä¸‹å†…å®¹ï¼š

   ```json
   {
   	"config": {
   		"chainId": 15,
   		"homesteadBlock": 0,
   		"eip155Block": 0,
   		"eip158Block": 0
   	},
   	"alloc": {
   		"0xeb680f30715f347d4eb5cd03ac5eced297ac5046": {
   			" balance": " 1000000000000 0000000000000000000"
   		}
   	},
   	"coinbase": "0x0000000000000000000000000000000000000000",
   	"difficulty": "0x01",
   	"extraData": "0x777573686f756865",
   	"gasLimit": "0xffffffff",
   	"nonce": "0x0000000000000001",
   	"mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
   	"parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
   	"timestamp": "0x00"
   }
   ```

3. ####æŒ‡å®šåŒºå—é“¾æ•°æ®å­˜æ”¾ç›®å½•ï¼Œå¹¶åˆå§‹åŒ–

   ```
   $ mkdir db
   $ geth --datadir "./db" init gensis.json
   ```

   çœ‹åˆ°ä»¥ä¸‹ç»“æœä¾¿æˆåŠŸäº†

   ```
   INFO [08-24|10:39:18.427] Maximum peer count                       ETH=25 LES=0 total=25
   INFO [08-24|10:39:18.446] Allocated cache and file handles         database=/Users/mjf1986/Downloads/gethtest/db/geth/chaindata cache=16 handles=16
   INFO [08-24|10:39:18.462] Writing custom genesis block 
   INFO [08-24|10:39:18.468] Persisted trie from memory database      nodes=1 size=153.00B time=822.831Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
   INFO [08-24|10:39:18.470] Successfully wrote genesis state         database=chaindata                                           hash=aab8e5â€¦a54b28
   INFO [08-24|10:39:18.470] Allocated cache and file handles         database=/Users/mjf1986/Downloads/gethtest/db/geth/lightchaindata cache=16 handles=16
   INFO [08-24|10:39:18.473] Writing custom genesis block 
   INFO [08-24|10:39:18.474] Persisted trie from memory database      nodes=1 size=153.00B time=95.707Âµs  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B
   INFO [08-24|10:39:18.475] Successfully wrote genesis state         database=lightchaindata                                           hash=aab8e5â€¦a54b28
   ```

   æ­¤æ—¶ç”Ÿæˆgethå’Œkeystoreä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹

   ```
   $ tree
   .
   â”œâ”€â”€ db
   â”‚Â Â  â”œâ”€â”€ geth
   â”‚Â Â  â”‚Â Â  â”œâ”€â”€ chaindata
   â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 000001.log
   â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ CURRENT
   â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ LOCK
   â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ LOG
   â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ MANIFEST-000000
   â”‚Â Â  â”‚Â Â  â””â”€â”€ lightchaindata
   â”‚Â Â  â”‚Â Â      â”œâ”€â”€ 000001.log
   â”‚Â Â  â”‚Â Â      â”œâ”€â”€ CURRENT
   â”‚Â Â  â”‚Â Â      â”œâ”€â”€ LOCK
   â”‚Â Â  â”‚Â Â      â”œâ”€â”€ LOG
   â”‚Â Â  â”‚Â Â      â””â”€â”€ MANIFEST-000000
   â”‚Â Â  â””â”€â”€ keystore
   â””â”€â”€ gensis.json
   ```

4. #### å¯åŠ¨èŠ‚ç‚¹

   ````
   $ geth --datadir "./db" --rpc --rpcaddr=0.0.0.0 --rpcport 8545 --rpccorsdomain "*" --rpcapi "eth, net, web3, personal, admin, shh, txpool, debug, miner" --nodiscover --maxpeers 30 --networkid 1981 --port 30303 --mine --minerthreads 1 --etherbase "0xeb680f30715f347d4eb5cd03ac5eced297ac5046" console
   ````

   è¿™é‡Œå¯åŠ¨äº†æŒ–çŸ¿æ¨¡å¼ï¼Œçœ‹åˆ°å°é”¤å­è¯´æ˜å·²ç»å¼€å§‹æŒ–çŸ¿ã€‚

   ```
   INFO [08-24|11:08:08.129] Maximum peer count                       ETH=30 LES=0 total=30
   INFO [08-24|11:08:08.145] Starting peer-to-peer node               instance=Geth/v1.8.13-stable/darwin-amd64/go1.10.3
   INFO [08-24|11:08:08.146] Allocated cache and file handles         database=/Users/mjf1986/Downloads/gethtest/db/geth/chaindata cache=768 handles=128
   INFO [08-24|11:08:08.181] Initialised chain configuration          config="{ChainID: 15 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: 0 EIP158: 0 Byzantium: <nil> Constantinople: <nil> Engine: unknown}"
   INFO [08-24|11:08:08.181] Disk storage enabled for ethash caches   dir=/Users/mjf1986/Downloads/gethtest/db/geth/ethash count=3
   INFO [08-24|11:08:08.181] Disk storage enabled for ethash DAGs     dir=/Users/mjf1986/.ethash                           count=2
   INFO [08-24|11:08:08.182] Initialising Ethereum protocol           versions="[63 62]" network=1981
   INFO [08-24|11:08:08.184] Loaded most recent local header          number=0 hash=aab8e5â€¦a54b28 td=1
   INFO [08-24|11:08:08.184] Loaded most recent local full block      number=0 hash=aab8e5â€¦a54b28 td=1
   INFO [08-24|11:08:08.184] Loaded most recent local fast block      number=0 hash=aab8e5â€¦a54b28 td=1
   INFO [08-24|11:08:08.186] Regenerated local transaction journal    transactions=0 accounts=0
   INFO [08-24|11:08:08.190] Starting P2P networking 
   INFO [08-24|11:08:08.191] RLPx listener up                         self="enode://bda460dfde90f467642a4708a8117982e15ecb68e07f840c6e9952a9ea503ba4946fc91fd49b2f51fdad198f894da8ab202fbbbc31c679e5e2982127c0188c15@[::]:30303?discport=0"
   INFO [08-24|11:08:08.203] IPC endpoint opened                      url=/Users/mjf1986/Downloads/gethtest/db/geth.ipc
   INFO [08-24|11:08:08.204] HTTP endpoint opened                     url=http://0.0.0.0:8545                           cors=* vhosts=localhost
   INFO [08-24|11:08:08.204] Transaction pool price threshold updated price=18000000000
   INFO [08-24|11:08:08.204] Starting mining operation 
   INFO [08-24|11:08:08.206] Commit new mining work                   number=1 txs=0 uncles=0 elapsed=1.867ms
   INFO [08-24|11:08:08.231] Mapped network port                      proto=tcp extport=30303 intport=30303 interface=NAT-PMP(192.168.31.1)
   Welcome to the Geth JavaScript console!

   instance: Geth/v1.8.13-stable/darwin-amd64/go1.10.3
   coinbase: 0xeb680f30715f347d4eb5cd03ac5eced297ac5046
   at block: 0 (Thu, 01 Jan 1970 08:00:00 CST)
    datadir: /Users/mjf1986/Downloads/gethtest/db
    modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

   > INFO [08-24|11:08:11.010] Generating DAG in progress               epoch=0 percentage=0 elapsed=1.709s
   INFO [08-24|11:08:12.768] Generating DAG in progress               epoch=0 percentage=1 elapsed=3.468s
   INFO [08-24|11:08:14.352] Generating DAG in progress               epoch=0 percentage=2 elapsed=5.052s
   INFO [08-24|11:08:15.955] Generating DAG in progress               epoch=0 percentage=3 elapsed=6.655s
   â€¦â€¦
   INFO [08-24|11:12:52.011] Successfully sealed new block            number=9 hash=d4a482â€¦4af928
   INFO [08-24|11:12:52.014] ğŸ”— block reached canonical chain          number=4 hash=5b54efâ€¦e46551
   INFO [08-24|11:12:52.014] ğŸ”¨ mined potential block                  number=9 hash=d4a482â€¦4af928
   â€¦â€¦
   ```

   è¿™é‡Œæä¸€ä¸‹EthashæŒ–çŸ¿æµç¨‹ï¼š

   ```
   åŒºå—å¤´->ç§å­->16Méšæœºæ•°Cache->1GBæ•°æ®é›†DAG->ä»DAGé€‰æ‹©å…ƒç´ å“ˆå¸Œ->éªŒè¯å“ˆå¸Œç»“æœå°äºæŸä¸ªå€¼
   ```

   Cache å’Œ DAG æ¯ä¸€ä¸ª å‘¨æœŸ æ›´æ–° ä¸€æ¬¡ï¼Œ æ¯ 30000 ä¸ª å— æ›´æ–° ä¸€æ¬¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ è¿™ 30000 ä¸ª å— äº§ç”Ÿ çš„ Cache å’Œ DAG æ˜¯ å®Œå…¨ ä¸€æ · çš„ï¼Œ å› æ­¤ æŒ– çŸ¿ çš„ ä¸»è¦ å·¥ä½œ åœ¨äº ä» DAG ä¸­ è¯»å– æ•°æ®ï¼Œ è€Œ ä¸æ˜¯ æ›´æ–° Cache å’Œ DAGï¼Œ DAG çš„ å¤§å° éšæ—¶ é—´çš„ æ¨ç§» çº¿æ€§ å¢é•¿ã€‚

5. ####è¿›å…¥JavaScriptå¹³å°ï¼Œåœ¨æ­¤ä½¿ç”¨ä»¥å¤ªåŠå†…ç½®å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚

   ```
   $ geth --datadir './db' attach ipc:./db/geth.ipc

   Welcome to the Geth JavaScript console!

   instance: Geth/v1.8.13-stable/darwin-amd64/go1.10.3
   coinbase: 0xeb680f30715f347d4eb5cd03ac5eced297ac5046
   at block: 187 (Fri, 24 Aug 2018 11:22:07 CST)
    datadir: /Users/mjf1986/Downloads/gethtest/db
    modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0

   > 

   ```

6. #### é€€å‡ºä»¥å¤ªåŠ

   ```
   > exit
   ```

   â€‹